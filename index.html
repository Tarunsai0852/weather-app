<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Live weather</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./index.css">
  </head>


  <body>
    <div class="searchbar">
      <div class="border border-1 border-white searchbarparentdiv">
        <input type="text" class="inputfield " placeholder="Search City">
        <img src="./icons8-duckduckgo-48.png" class="searchicon" onclick="fetchdata()">
      </div>
    </div>
    <div class="maincontentparentdiv d-flex">
        <div class="leftdiv">
           <div class="currenttempdiv leftchild glass-card highlight-card p-3 d-flex flex-column gap-2">
                <h6 class="m-0" id="cityname">city name</h6>
                <h5 class="m-0"><span id="citytemp"></span> &deg;C</h5>
                <h6 class="m-0" id="skydesc">weather condition</h6>
                <hr class="line">
                <div class="d-flex align-items-center gap-2 date-row">
                   <img src="./calendar.png" alt="calendar icon" width="25px" class="icon-animate">
                     <h6 class="m-0" id="date">Date</h6>
                </div>
                <div class="d-flex align-items-center gap-2 time-row">
                    <img src="./time.png" alt="clock icon" width="25px" class="icon-animate">
                    <h6 class="m-0" id="time">time</h6>
                 </div>
            </div>
           <div class="nextfiveday leftchild glass-card p-3 d-flex flex-column">
           <h6 class="m-0 " id="comingfivedaystitle"> Coming 5 days</h6>
           <div class="d-flex flex-column gap-2 mt-3" id="forecastList"></div>
           </div>
        </div>
      <div class="rightdiv">
        <div class="rightrow  rowOne d-flex gap-2 justify-content-around align-items-center p-3">
          <div class="extraMetric glass-card d-flex gap-3 align-items-center metric-card">
            <img src="./cloud.png" alt="feels like icon" width="30px" class="icon-animate">
            <div>
              <h6 class="m-0 text-uppercase">Feels like</h6>
              <h6 class="m-0" id="feelsLike">--</h6>
            </div>
          </div>
          <div class="extraMetric glass-card d-flex gap-3 align-items-center metric-card">
            <img src="./humidity.png" alt="humidity icon" width="30px" class="icon-animate">
            <div>
              <h6 class="m-0 text-uppercase">Humidity</h6>
              <h6 class="m-0" id="humidityMetric">--</h6>
            </div>
          </div>
            <div class="extraMetric glass-card d-flex gap-3 align-items-center metric-card">
            <img src="./wind.png" alt="wind icon" width="30px" class="icon-animate">
            <div>
              <h6 class="m-0 text-uppercase">Wind</h6>
              <h6 class="m-0" id="windMetric">--</h6>
            </div>
          </div>
            <div class="extraMetric glass-card d-flex gap-3 align-items-center metric-card">
            <img src="./time.png" alt="pressure icon" width="30px" class="icon-animate">
            <div>
              <h6 class="m-0 text-uppercase">Pressure</h6>
              <h6 class="m-0" id="pressureMetric">--</h6>
            </div>
          </div>
        </div>
        <div class="rightrow rowtwo d-flex justify-content-between align-items-center ">
         <div class="aqi rowtwodiv glass-card p-3 d-flex flex-column gap-2">
          <h5>air quality index(aqi)</h5>
          <div  class="d-flex align-items-center">
            <img src="./good.png" alt="" width="50px">
            <div class="text-center">
              <h6 id="co">aqi metric</h6>
              <h6 id="covalue">0</h6>
            </div>
            <div class="text-center">
              <h6 id="so2">aqi metric</h6>
              <h6 id="so2value">0</h6>
            </div>
            <div class="text-center">
              <h6 id="o3">aqi metric</h6>
              <h6 id="o3value">0</h6>
            </div>
            <div class="text-center">
              <h6 id="no2">aqi metric</h6>
              <h6 id="no2value">0</h6>
            </div>
          </div>
        </div>
        <div class="sunrise rowtwodiv glass-card p-3">
         <h5 class="m-0">sunrise&sunset</h5>
         <div class="d-flex justify-content-between">
         <div class="sunrisediv">
          <img src="./sun.png" alt="" width="40px" class="icon-animate slow-float">
          <div class="d-flex flex-column gap-1">
            <h6 class="m-0">sunrise time</h6>
            <h6 class="m-0"id = "sunrisetime">6:00 am</h6>  

          </div>
         </div>
         <div class="sunsetdiv d-flex align-items-center">
          <img src="./moon.png" alt="" width="40px" class="icon-animate slow-float">
          <div class="d-flex flex-column gap-2">
            <h6 class="m-0">sunset time</h6>  
            <h5 class="m-0" id="sunsetime">7:00 pm</h5>
          </div>
         </div>
        </div>
        </div>
        </div>
        <div class="rightrow rowthreediv todaytempparentdiv glass-card p-3">
          <h5 class="p-3 m-0">today</h5>
          <div class="d-flex justify-content-between flex-wrap gap-3" id="todayTimeline"></div>
        </div>
    </div>
 </div>   
</div>
   <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js" integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>  
<script>
  const API_KEY = '992a5fd81365f5552528a1629e26aeab';

function toLocalDate(timestamp, timezoneOffset = 0) {
  // Convert UTC timestamp + offset (both in seconds)
  return new Date((timestamp + timezoneOffset) * 1000);
}

function formatDateParts(timestamp, timezoneOffset = 0) {
  const date = toLocalDate(timestamp, timezoneOffset);
  return {
    date: date.toLocaleDateString('en-US', { timeZone: 'UTC' }),
    time: date.toLocaleTimeString('en-US', { timeZone: 'UTC', hour: '2-digit', minute: '2-digit' })
  };
}

  function updateMetricCards(weather) {
    $('#feelsLike')[0].innerText = `${Math.round(weather.main.feels_like)} �C`;
    $('#humidityMetric')[0].innerText = `${weather.main.humidity}%`;
    $('#windMetric')[0].innerText = `${Math.round(weather.wind.speed)} m/s`;
    $('#pressureMetric')[0].innerText = `${weather.main.pressure} hPa`;
  }

  function formatDay(date) {
    return {
      label: date.toLocaleDateString(),
      weekday: date.toLocaleDateString(undefined, { weekday: 'long' })
    };
  }

  function buildDateKey(timestamp, timezoneOffset = 0) {
    return toLocalDate(timestamp, timezoneOffset).toISOString().split('T')[0];
  }

  function renderForecastRows(forecastList, timezoneOffset = 0) {
    const container = document.getElementById('forecastList');
    if (!container) {
      return;
    }
    container.innerHTML = '';

    const grouped = forecastList.reduce((acc, entry) => {
      const key = buildDateKey(entry.dt, timezoneOffset);
      acc[key] = acc[key] || [];
      acc[key].push(entry);
      return acc;
    }, {});

    const todayKey = buildDateKey(Date.now() / 1000, timezoneOffset);
    const upcomingDays = Object.keys(grouped)
      .filter(date => date !== todayKey)
      .sort()
      .slice(0, 5)
      .map(dateKey => {
        const entries = grouped[dateKey];
        const preferred = entries.find(item => item.dt_txt.includes('12:00:00')) || entries[0];
        const { label, weekday } = formatDay(toLocalDate(preferred.dt, timezoneOffset));
        return {
          weekday,
          label,
          temp: Math.round(preferred.main.temp),
          description: preferred.weather[0].description,
          icon: preferred.weather[0].icon
        };
      });

    upcomingDays.forEach(day => {
      const row = document.createElement('div');
      row.className = 'forecaastrow d-flex align-items-center justify-content-between';
      row.innerHTML = `
        <div class="d-flex gap-2 align-items-center">
          <span class="forecast-dot"></span>
          <div>
            <h6 class="m-0">${day.temp} &deg;C</h6>
            <small class="text-capitalize">${day.description}</small>
          </div>
        </div>
        <h6 class="m-0 text-capitalize">${day.weekday}</h6>
        <h6 class="m-0">${day.label}</h6>
      `;
      container.appendChild(row);
    });
  }

  function renderTodayTimeline(forecastList, timezoneOffset = 0) {
    const timeline = document.getElementById('todayTimeline');
    if (!timeline) {
      return;
    }
    timeline.innerHTML = '';

    const todayKey = buildDateKey(Date.now() / 1000, timezoneOffset);
    const todaysEntries = forecastList.filter(item => buildDateKey(item.dt, timezoneOffset) === todayKey);
    const slots = (todaysEntries.length >= 5 ? todaysEntries : forecastList).slice(0, 5);

    slots.forEach(entry => {
      const timeLabel = formatDateParts(entry.dt, timezoneOffset).time;
      const card = document.createElement('div');
      card.className = 'todaytemp glass-card mini-card';
      card.innerHTML = `
        <h6 class="m-0">${timeLabel}</h6>
        <img src="https://openweathermap.org/img/wn/${entry.weather[0].icon}.png" alt="${entry.weather[0].description}" width="40">
        <h5 class="m-0">${Math.round(entry.main.temp)}&deg;C</h5>
      `;
      timeline.appendChild(card);
    });
  }

  async function fetchaqidata(lat, lon) {
    const response = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${API_KEY}`);
    if (!response.ok) {
      throw new Error('Failed to fetch AQI data');
    }

    const formatteddata = await response.json();
    const list = formatteddata.list[0].components;

    $('#co')[0].innerText = 'CO';
    $('#covalue')[0].innerText = `${list.co} ug/m3`;
    $('#so2')[0].innerText = 'SO2';
    $('#so2value')[0].innerText = `${list.so2} ug/m3`;
    $('#o3')[0].innerText = 'O3';
    $('#o3value')[0].innerText = `${list.o3} ug/m3`;
    $('#no2')[0].innerText = 'NO2';
    $('#no2value')[0].innerText = `${list.no2} ug/m3`;
  }

  async function fetchForecast(lat, lon) {
    const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&appid=${API_KEY}`);
    if (!response.ok) {
      throw new Error('Failed to fetch forecast data');
    }
    return response.json();
  }

  async function fetchdata() {
    const cityInput = document.getElementsByClassName('inputfield')[0];
    const cityname = cityInput.value.trim();

    if (!cityname) {
      alert('Please enter a city name.');
      return;
    }

    try {
      const requestdata = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(cityname)}&units=metric&appid=${API_KEY}`);
      if (!requestdata.ok) {
        throw new Error('City not found');
      }

      const responsedata = await requestdata.json();
      const responsecityname = responsedata.name;
      const responsecitytemp = Math.round(responsedata.main.temp);
      const skydescription = responsedata.weather[0].description;
      const timezoneOffset = responsedata.timezone || 0;

      $('#cityname')[0].innerText = responsecityname;
      $('#citytemp')[0].innerText = responsecitytemp;
      $('#skydesc')[0].innerText = skydescription;
      updateMetricCards(responsedata);

      const formattedNow = formatDateParts(responsedata.dt, timezoneOffset);
      $('#date')[0].innerText = formattedNow.date;
      $('#time')[0].innerText = formattedNow.time;

      const { time: sunriseTime } = formatDateParts(responsedata.sys.sunrise, timezoneOffset);
      const { time: sunsetTime } = formatDateParts(responsedata.sys.sunset, timezoneOffset);
      console.log(responsedata);
      $('#sunrisetime')[0].innerText = sunriseTime;
      $('#sunsetime')[0].innerText = sunsetTime;

      const lat = responsedata.coord.lat;
      const lon = responsedata.coord.lon;
      await Promise.all([
        fetchaqidata(lat, lon),
        fetchForecast(lat, lon).then(forecastdata => {
          renderForecastRows(forecastdata.list, timezoneOffset);
          renderTodayTimeline(forecastdata.list, timezoneOffset);
        })
      ]);
    } catch (error) {
      console.error('Weather fetch failed:', error);
      alert('Unable to fetch weather data. Please check the city name and try again.');
    }
  }

  document.querySelector('.inputfield').addEventListener('keyup', event => {
    if (event.key === 'Enter') {
      fetchdata();
    }
  });
</script>






</body>

</html>


